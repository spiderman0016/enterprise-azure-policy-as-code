
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://azure.github.io/enterprise-azure-policy-as-code/policy-assignments/">
      
      
        <link rel="prev" href="../policy-set-definitions/">
      
      
        <link rel="next" href="../policy-exemptions/">
      
      
      <link rel="icon" href="../Images/10316-icon-service-Policy.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Policy Assignments - Enterprise Policy As Code (EPAC)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#policy-assignments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-header__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Enterprise Policy As Code (EPAC)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Policy Assignments
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../breaking-changes-v6.0/" class="md-tabs__link">
          
  
    
  
  Breaking Changes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../operating-environment/" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../policy-definitions/" class="md-tabs__link">
          
  
    
  
  Policy Objects

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ci-cd-pipeline/" class="md-tabs__link">
          
  
    
  
  CI/CD

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../integrating-with-alz/" class="md-tabs__link">
          
  
    
  
  CAF ALZ Integration

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../documenting-assignments-and-policy-sets/" class="md-tabs__link">
          
  
    
  
  Creating Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../operational-scripts/" class="md-tabs__link">
          
  
    
  
  Operational Scripts

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-nav__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    Enterprise Policy As Code (EPAC)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Breaking Changes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Breaking Changes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../breaking-changes-v6.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Breaking changes in v6.0
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operating-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operating Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clone-github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloning the Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../powershell-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerShell Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../definitions-and-global-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Definitions and Global Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../desired-state-strategy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desired State Strategy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extract-existing-policy-resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extracting Existing Policy Resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Policy Objects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Policy Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-set-definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Set Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Policy Assignments
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Policy Assignments
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assignment-json-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment JSON structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assignment JSON structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tree-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Tree Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-naming-element" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment Naming Element
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assigning-policy-sets-or-policies" class="md-nav__link">
    <span class="md-ellipsis">
      Assigning Policy Sets or Policies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-scopes-and-excluded-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment scopes and excluded scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed-identities-and-role-assignments" class="md-nav__link">
    <span class="md-ellipsis">
      Managed Identities and role assignments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managed Identities and role assignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-managedidentitylocations" class="md-nav__link">
    <span class="md-ellipsis">
      Defining managedIdentityLocations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-optional-additionalroleassignments" class="md-nav__link">
    <span class="md-ellipsis">
      Defining optional additionalRoleAssignments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-assigned-managed-identities" class="md-nav__link">
    <span class="md-ellipsis">
      User-assigned Managed Identities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-parameters-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining parameters with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-overrides-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining overrides with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-noncompliancemessages-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining nonComplianceMessages with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-parameters-overrides-and-noncompliancemessages-with-a-csv-file" class="md-nav__link">
    <span class="md-ellipsis">
      Defining parameters, overrides and nonComplianceMessages with a CSV file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-resourceselectors" class="md-nav__link">
    <span class="md-ellipsis">
      Defining resourceSelectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Defining metadata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-enforcementmode" class="md-nav__link">
    <span class="md-ellipsis">
      Defining enforcementMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-assignment-files" class="md-nav__link">
    <span class="md-ellipsis">
      Example assignment files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example assignment files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-policy-assignment-allowed-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Policy Assignment (Allowed Locations)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-focused-policy-assignment-with-json-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Security-Focused Policy Assignment with JSON parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-focused-policy-assignment-with-csv-file-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Security-Focused Policy Assignment with CSV file parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inverted-policy-assignment-tag-inheritance-and-required-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Inverted Policy Assignment (Tag Inheritance and Required Tags)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-definition-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Definition Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-set-definition-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Set Definition Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-set-definition-assignment-with-a-definitionentrylist" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Set Definition Assignment with a definitionEntryList
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-list" class="md-nav__link">
    <span class="md-ellipsis">
      Reading List
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-exemptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Exemptions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CI/CD
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CI/CD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Pipeline
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CAF ALZ Integration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            CAF ALZ Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-alz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrating EPAC with Azure Landing Zones
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Creating Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Creating Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documenting-assignments-and-policy-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documenting Policy Resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operational Scripts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Operational Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operational Scripts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assignment-json-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment JSON structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assignment JSON structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tree-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Tree Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-naming-element" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment Naming Element
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assigning-policy-sets-or-policies" class="md-nav__link">
    <span class="md-ellipsis">
      Assigning Policy Sets or Policies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-scopes-and-excluded-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment scopes and excluded scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed-identities-and-role-assignments" class="md-nav__link">
    <span class="md-ellipsis">
      Managed Identities and role assignments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managed Identities and role assignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-managedidentitylocations" class="md-nav__link">
    <span class="md-ellipsis">
      Defining managedIdentityLocations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-optional-additionalroleassignments" class="md-nav__link">
    <span class="md-ellipsis">
      Defining optional additionalRoleAssignments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-assigned-managed-identities" class="md-nav__link">
    <span class="md-ellipsis">
      User-assigned Managed Identities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-parameters-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining parameters with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-overrides-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining overrides with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-noncompliancemessages-with-json" class="md-nav__link">
    <span class="md-ellipsis">
      Defining nonComplianceMessages with JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-parameters-overrides-and-noncompliancemessages-with-a-csv-file" class="md-nav__link">
    <span class="md-ellipsis">
      Defining parameters, overrides and nonComplianceMessages with a CSV file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-resourceselectors" class="md-nav__link">
    <span class="md-ellipsis">
      Defining resourceSelectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Defining metadata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-enforcementmode" class="md-nav__link">
    <span class="md-ellipsis">
      Defining enforcementMode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-assignment-files" class="md-nav__link">
    <span class="md-ellipsis">
      Example assignment files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example assignment files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-policy-assignment-allowed-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Policy Assignment (Allowed Locations)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-focused-policy-assignment-with-json-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Security-Focused Policy Assignment with JSON parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-focused-policy-assignment-with-csv-file-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Security-Focused Policy Assignment with CSV file parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inverted-policy-assignment-tag-inheritance-and-required-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Inverted Policy Assignment (Tag Inheritance and Required Tags)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-definition-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Definition Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-set-definition-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Set Definition Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-compliance-messages-in-a-policy-set-definition-assignment-with-a-definitionentrylist" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Compliance Messages in a Policy Set Definition Assignment with a definitionEntryList
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-list" class="md-nav__link">
    <span class="md-ellipsis">
      Reading List
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="policy-assignments">Policy Assignments</h1>
<p>This chapter describes how <strong>Policy Assignments</strong> are handled by EPAC. To learn about how custom Policy and Policy Set definitions are managed, see the <a href="../policy-definitions/">Policies</a> and <a href="../policy-set-definitions/">Policy Set Definitions</a>.</p>
<h2 id="assignment-json-structure">Assignment JSON structure</h2>
<p>Assignment JSON is hierarchical for efficient definitions, avoiding duplication (copy/paste) of JSON. Each branch of the tree is cumulative. Each tree node must include a <code>nodeName</code> - an arbitrary string exclusively used by EPAC to display an error location. EPAC concatenates a leading <code>/</code> and the nodeName entries encountered in the tree to create a "breadcrumbs" trail; therefore, we recommend that you use <code>/</code> to help separate the concatenated <code>nodeName</code>. The following (partial and invalid) assignment tree would create this error message.</p>
<blockquote>
<p><code>Node "//Security/Prod/": only one definitionEntry or definitionEntryList can appear in any branch.</code></p>
</blockquote>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/Security/&quot;,
  &quot;definitionEntry&quot;: {
    &quot;policySetName&quot;: &quot;org-sec-initiative&quot;,
  },
  &quot;children&quot;: [
    {
      &quot;nodeName&quot;: &quot;Prod/&quot;,
      &quot;definitionEntry&quot;: {
        &quot;policySetName&quot;: &quot;org-sec-initiative&quot;,
      }
    }
  ]
}
</code></pre></div>
<h3 id="key-points">Key Points</h3>
<ul>
<li>Every tree branch must accumulate a <code>definitionEntry</code> (or <code>definitionEntryList</code>), Assignment naming (<code>name</code> and <code>displayName</code>) and <code>scope</code> element.</li>
<li>The elements <code>parameters</code>, <code>overrides</code>, <code>resourceSelectors</code>, <code>notScope</code>, <code>enforcementMode</code>, <code>metadata</code>, <code>userAssignedIdentity</code>, <code>managedIdentityLocations</code>,<code>additionalRoleAssignments</code>and<code>nonComplianceMessages</code> are optional.</li>
<li>For Policy Sets with large numbers of included Policies you should use a spreadsheet (CSV file) to manage <strong>effects</strong> (parameterized or effect <code>overrides</code>), <code>parameters</code> and optional <code>nonComplianceMessages</code>. We recommend the CSV approach for Policy Sets with more than 10 included Policies.</li>
<li>EPAC continues to support deprecated elements <code>initiativeId</code>, <code>initiativeName</code> and <code>ignoreBranch</code>, Consider using their replacements <code>policySetId</code>, <code>policySetName</code> and <code>enforcementMode</code> instead.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The tree is not required to be balanced. The number of levels is not restricted; however, anything beyond 3 levels is unnecessary in real scenarios and would be difficult to read and manage as the depth increases.</p>
</div>
<h3 id="tree-structure">Tree Structure</h3>
<p><img alt="Assignment File Overview Diagram" src="../Images/PaC-Assignment-Structure.png" /></p>
<h2 id="assignment-naming-element">Assignment Naming Element</h2>
<p>Each Assignment is required to have a <code>name</code> which is used in it's resource id. EPAC also requires a <code>displayName</code>. The <code>description</code> is optional. For the allowed location assignment you specify the component with:</p>
<div class="highlight"><pre><span></span><code>&quot;assignment&quot;: {
    &quot;name&quot;: &quot;allowed-locations&quot;,
    &quot;displayName&quot;: &quot;Allowed Locations&quot;,
    &quot;description&quot;: &quot;Sets the allowed locations.&quot;
},
</code></pre></div>
<p>Multiple <code>assignment</code> naming components in a tree branch are string concatenated for each of the three fields.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Azure has a limit of 24 characters for the concatenated <code>name</code> string. EPAC displays an error if this limit is exceeded.</p>
</div>
<h2 id="assigning-policy-sets-or-policies">Assigning Policy Sets or Policies</h2>
<p>Each assignment assigns either a Policy or Policy Set. In EPAC this is done with a <code>definitionEntry</code> or a <code>definitionEntryList</code>. Exactly one occurrence must exist in any collated tree branch. For each entry, you need to specify one of the following:</p>
<ul>
<li><code>policyName</code> - custom Policy managed by EPAC. Specifying just the name allows EPAC to inject the correct definition scope.</li>
<li><code>policySetName</code> - custom Policy Set managed by EPAC.</li>
<li><code>policyId</code> - resource id for builtin Policy.</li>
<li><code>policySetId</code> - resource id for builtin Policy Set.</li>
</ul>
<p><code>displayName</code> is an optional field to document the entry if the Policy name is a GUID. Builtin Policies and Policy Sets use a GUID.</p>
<div class="highlight"><pre><span></span><code>&quot;definitionEntry&quot;: {
    &quot;policySetName&quot;: &quot;general-allowed-locations-policy-set&quot;,
    &quot;displayName&quot;: &quot;Use this if the Policy name is a GUID&quot;
},
</code></pre></div>
<p>Using <code>definitionEntryList</code> allows you to save on copy/paste tree branches. Without it, the number of branches would need to be duplicated as many times as the list has entries.</p>
<p>Each entry in the list creates an Assignment at each leave of the tree. Since assignments must have unique names at a specific scope, the Assignment naming component must be amended for each list entry. In this sub-component you can decide if you want to concatenate the string by appending or prepending them by specifying <code>append</code> boolean value.</p>
<div class="highlight"><pre><span></span><code>&quot;definitionEntryList&quot;: [
    {
        &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/1f3afdf9-d0c9-4c3d-847f-89da613e70a8&quot;,
        &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
        &quot;assignment&quot;: {
            &quot;append&quot;: true,
            &quot;name&quot;: &quot;asb&quot;,
            &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
            &quot;description&quot;: &quot;Azure Security Benchmark Initiative. &quot;
        }
    },
    {
        &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
        &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
        &quot;assignment&quot;: {
            &quot;append&quot;: true,
            &quot;name&quot;: &quot;nist-800-53-r5&quot;,
            &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
            &quot;description&quot;: &quot;NIST SP 800-53 Rev. 5 Initiative.&quot;
        }
    }
],
</code></pre></div>
<p>In the above example one of the children (leaf node) has the following Assignment name.</p>
<div class="highlight"><pre><span></span><code>&quot;assignment&quot;: {
    &quot;name&quot;: &quot;pr-&quot;,
    &quot;displayName&quot;: &quot;Prod &quot;,
    &quot;description&quot;: &quot;Prod Environment controls enforcement with &quot;
},
</code></pre></div>
<p>This example generates two assignments at the "prod" leaf per scope:</p>
<ul>
<li>/providers/Microsoft.Management/managementGroups/<strong><em>Contoso-Prod</em></strong>/providers/Microsoft.Authorization/policyAssignments/<strong>pr-asb</strong></li>
<li><code>displayName</code> = "Prod Azure Security Benchmark"</li>
<li><code>description</code> = "Prod Environment controls enforcement with Azure Security Benchmark Initiative."</li>
<li>/providers/Microsoft.Management/managementGroups/<strong><em>Contoso-Prod</em></strong>/providers/Microsoft.Authorization/policyAssignments/<strong>pr-nist-800-53-r5</strong></li>
<li><code>displayName</code> = "Prod NIST SP 800-53 Rev. 5"</li>
<li><code>description</code> = "Prod Environment controls enforcement with NIST SP 800-53 Rev. 5 Initiative."</li>
</ul>
<h2 id="assignment-scopes-and-excluded-scopes">Assignment scopes and excluded scopes</h2>
<p><code>scope</code> is required exactly once in each tree branch. Excluded scopes (<code>notScope</code>) are cumulative from <code>global-settings.json</code> and the entire tree branch; however, once a scope is defined <code>notScope</code> may not be defined at any child node.</p>
<p>Both <code>scope</code> and <code>notScope</code> are specific to an <a href="../README.md#understanding-epac-environments-and-the-pacselector">EPAC Environment using the pacSelector name</a>, e.g., <code>epac-dev</code> and <code>tenant</code>.</p>
<div class="highlight"><pre><span></span><code>&quot;scope&quot;: {
    &quot;epac-dev&quot;: [
        &quot;/providers/Microsoft.Management/managementGroups/Epac-Prod&quot;
    ],
    &quot;tenant&quot;: [
        &quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod&quot;
        &quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod2&quot;
    ]
}
</code></pre></div>
<p><code>notScope</code> works the same. In addition <code>"*"</code> means all EPAC Environments which is most often used for <code>resourceGroupPatterns</code>.</p>
<div class="highlight"><pre><span></span><code>&quot;notScope&quot;: {
    &quot;*&quot;: [
        &quot;/resourceGroupPatterns/excluded-rg*&quot;
    ],
    &quot;tenant&quot;: [
        &quot;/providers/Microsoft.Management/managementGroups/Epac&quot;,
        &quot;/providers/Microsoft.Management/managementGroups/&quot;
    ]
}
</code></pre></div>
<h2 id="managed-identities-and-role-assignments">Managed Identities and role assignments</h2>
<p>Policies with a <code>DeployIfNotExists</code> or <code>Modify</code> effect need a Managed Identity (MI) and role assignments to execute remediation task. EPAC calculates the necessary role assignments based on the <code>roleDefinitionIds</code> in the Policy definition. By default EPAC uses a system-assigned Manged Identity. The team maintaining EPAC recommend system-assigned identities; however, your organization may have role assignment reasons to use user-assigned Managed Identities.</p>
<h3 id="defining-managedidentitylocations">Defining <code>managedIdentityLocations</code></h3>
<p>Policy assignments requiring a Managed Identity (system-assigned or user-assigned) require a location <code>managedIdentityLocations</code>. You must specify the location based on EPAC Environment or use <code>"*"</code> to use the same location for all of the EPAC Environments.
You can specify them in <code>global-settings.jsonc</code> or at any node in the tree. The last (closest to the leaf node) is the one chosen if multiple <code>managedIdentityLocations</code> entries are encountered in a tree branch.</p>
<div class="highlight"><pre><span></span><code>&quot;managedIdentityLocations&quot;: {
    &quot;*&quot;: &quot;eastus2&quot;
},
</code></pre></div>
<h3 id="defining-optional-additionalroleassignments">Defining optional <code>additionalRoleAssignments</code></h3>
<p>In some scenarios you will need <code>additionalRoleAssignments</code>; e.g., for diagnostics settings to Event Hubs, the target resource might be in a different Management Group and therefore the Managed Identity requires additional role assignments. You must specify the <code>additionalRoleAssignments</code> based on EPAC Environment or use <code>"*"</code>to use the same <code>additionalRoleAssignments</code>for all of the EPAC Environments.</p>
<div class="highlight"><pre><span></span><code>&quot;additionalRoleAssignments&quot;: {
    &quot;*&quot;: [
        {
            &quot;roleDefinitionId&quot;: &quot;/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
            &quot;scope&quot;: &quot;/subscriptions/&lt;id&gt;/resourceGroups/&lt;example&gt;&quot;
        }
    ]
},
</code></pre></div>
<h3 id="user-assigned-managed-identities">User-assigned Managed Identities</h3>
<p>Azure Policy can use a user-defined Managed Identity and EPAC allows you to use this functionality (new in version 7.0). You must specify the user-defined Managed Identity based on EPAC Environment or use <code>"*"</code> to use the same identity for all of the EPAC Environments (only possible in single tenant scenarios). Within each EPAC Environment entry, you can specify just the URI string indicating to use the same identity even if we are using a <code>definitionEntryList</code>, or in the case of a <code>definitionEntryList</code> can assign a different identity based on the definitionEntryList by specifying a matching <code>policyName</code>, <code>policyId</code>, <code>policySetName</code> or <code>policySetId</code>.</p>
<div class="highlight"><pre><span></span><code>&quot;userAssignedIdentity&quot;: {
    // For single definitionEntry or when using the same identity for all definitions being assigned
    &quot;tenant1&quot;: &quot;/subscriptions/id/resourceGroups/testRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity-1&quot;,
    &quot;tenant2&quot;: [
      // differentiate by assigned definition
      {
          &quot;policySetName&quot;: &quot;somePolicySetName&quot;,
          &quot;identity&quot;: &quot;/subscriptions/id/resourceGroups/testRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity-2&quot;
      },
      {
          &quot;policySetId&quot;: &quot;somePolicySetId&quot;,
          &quot;identity&quot;: &quot;/subscriptions/id/resourceGroups/testRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity-3&quot;
      }
    ]
}
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The rest (below) of the node components are optional.</p>
</div>
<h2 id="defining-parameters-with-json">Defining <code>parameters</code> with JSON</h2>
<p><code>parameters</code> have a simple JSON structure. You do not need the additional <code>value</code> indirection Azure requests (EPAC will inject that indirection).</p>
<div class="highlight"><pre><span></span><code>&quot;parameters&quot;: {
  &quot;aksClusterContainersAllowedImagesExcludedNamespaces&quot;: [
    &quot;kube-system&quot;,
    &quot;gatekeeper-system&quot;,
    &quot;azure-arc&quot;
  ],
  &quot;kvKeysActiveMaximumNumberOfDays&quot;: 90,
  &quot;publicNetworkAccessShouldBeDisabledForContainerRegistriesEffect&quot;: &quot;Audit&quot;,
  &quot;mysqlDisablePublicNetworkAccessEffect&quot;: &quot;Deny&quot;,
  &quot;kvRsaCryptographyMinimumKeySizeEffect&quot;: &quot;Deny&quot;,
},
</code></pre></div>
<p>Too enable <code>definitionEntryList</code>, parameters not present in the Policy or Policy Set definition are quietly ignored.</p>
<h2 id="defining-overrides-with-json">Defining <code>overrides</code> with JSON</h2>
<p><code>overrides</code> are in the same <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/assignment-structure#overrides-preview">format as documented by Azure</a>. They are  cumulative in each tree branch. The <code>selectors</code> element is only used for Assignments of Policy Sets. They are not valid for Assignments of a single Policy.</p>
<p>If using <code>definitionEntryList</code>, you must add the <code>policyName</code>, <code>policyId</code>, <code>policySetName</code> or <code>policySetId</code> as used in the <code>definitionEntryList</code> item.</p>
<div class="highlight"><pre><span></span><code>&quot;overrides&quot;: [
    {
        &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
        &quot;kind&quot;: &quot;policyEffect&quot;,
        &quot;value&quot;: &quot;AuditIfNotExists&quot;,
        &quot;selectors&quot;: [
            {
                &quot;kind&quot;: &quot;policyDefinitionReferenceId&quot;,
                &quot;in&quot;: [
                    &quot;331e8ea8-378a-410f-a2e5-ae22f38bb0da&quot;,
                    &quot;385f5831-96d4-41db-9a3c-cd3af78aaae6&quot;
                ]
            }
        ]
    },
    {
        &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
        &quot;kind&quot;: &quot;policyEffect&quot;,
        &quot;value&quot;: &quot;AuditIfNotExists&quot;,
        &quot;selectors&quot;: [
            {
                &quot;kind&quot;: &quot;policyDefinitionReferenceId&quot;,
                &quot;in&quot;: [
                    &quot;cddd188c-4b82-4c48-a19d-ddf74ee66a01&quot;,
                    &quot;3cf2ab00-13f1-4d0c-8971-2ac904541a7e&quot;
                ]
            }
        ]
    }
],
</code></pre></div>
<h2 id="defining-noncompliancemessages-with-json">Defining <code>nonComplianceMessages</code> with JSON</h2>
<p>Assign a non-compliance message to the assignment, or individual non-compliance messages if the assignment is for an Policy Set. This value is an array of objects - each containing a message, and in the case of an initiative a policyDefinitionReferenceId. See <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/assignment-structure#non-compliance-messages">this link</a> for details.</p>
<p>If you use single <code>definitionEntry</code>, place them normally. If you use a <code>definitionEntryList</code> place them in the respective list entry.</p>
<div class="highlight"><pre><span></span><code>&quot;nonComplianceMessages&quot;: [
    {
        &quot;message&quot;: &quot;Update main message&quot;
        // Default nonComplianceMessage
    },
    {
        &quot;message&quot;: &quot;Individual policy message&quot;,
        // Policy specific nonComplianceMessage. You must include the policyDefinitionReferenceId as defined in the Policy Set.
        &quot;policyDefinitionReferenceId&quot;: &quot;ASC_DeployAzureDefenderForSqlAdvancedThreatProtectionWindowsAgent&quot;
    }
],
</code></pre></div>
<h2 id="defining-parameters-overrides-and-noncompliancemessages-with-a-csv-file">Defining <code>parameters</code>, <code>overrides</code> and <code>nonComplianceMessages</code> with a CSV file</h2>
<p>Assigning single or multiple security and compliance focused Policy Sets (Initiatives), such as Azure Security Benchmark, NIST 800-53 r5, PCI, NIST 800-171, etc, with just JSON parameters becomes very complex fast. Add to this the complexity of overriding the effect if it is not surfaced as a parameter in the Policy Set using <code>overrides</code>. Finally, adding the optional <code>nonComplianceMessages</code> further increases the complexity.</p>
<p>To address the problem of reading and maintaining hundreds or thousands of JSON lines, EPAC can use the content of a spreadsheet (CSV) to create <code>parameters</code>, <code>overrides</code> and optionally <code>nonComplianceMessages</code> for a single Policy assignment <code>definitionEntry</code> or multiple Policy definitions (<code>definitionEntryList</code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This approach is best for very large Policy Sets such as Azure Security Benchmark, NIST 800-53, etc. Smaller Policy Sets should still be handled with JSON <code>parameters</code>, <code>overrides</code> and <code>nonComplianceMessages</code>.</p>
</div>
<p>Start by <a href="../documenting-assignments-and-policy-sets/#policy-set-documentation">generating documentation for one or more of those Policy Sets</a>, then modify the effect and parameter columns for each type of environment types you will use. In the example header below the infrastructure environments prod, test, dev, and sandbox are used as prefixes to the columns for Effect and Parameters respectively. Optionally you can add a column for <code>nonComplianceMessages</code>. If you want to switch from JSON to CSV, you can <a href="../documenting-assignments-and-policy-sets/#assignment-documentation">generate this CSV file frm your already deployed Assignment(s)</a>.</p>
<p>The CSV file generated contains the following headers/columns:</p>
<p><code>name,referencePath,policyType,category,displayName,description,groupNames,policySets,allowedEffects,allowedOverrides,prodEffect,testEffect,devEffect,sandboxEffect,prodParameters,testParameters,devParameters,sandboxParameters,nonComplianceMessages</code></p>
<p>Column explanations:</p>
<ul>
<li><code>name</code> is the name of the policyDefinition referenced by the Policy Sets being assigned.</li>
<li><code>referencePath</code> is only used if the Policy is used more than once in at least one of the Policy Sets to disambiguate them. The format is <code>&lt;policySetName&gt;//&lt;policyDefinitionReferenceId&gt;</code>.</li>
<li><code>policyType</code>,<code>category</code>,<code>displayName</code>,<code>description</code>,<code>groupNames</code>,<code>policySets</code>,<code>allowedEffects</code> are optional and not used for deployment planning. They assist you in filling out the <code>&lt;env&gt;Effect</code> columns.</li>
<li><code>&lt;env&gt;Effect</code> columns must contain one of the allowedValues or allowedOverrides values. You define which scopes define each type of environment and what short name you give the environment type to use as a column prefix.</li>
<li><code>&lt;env&gt;Parameters</code> can contain additional parameters. You can also specify such parameters in JSON. EPAC will use the union of all parameters.</li>
<li><code>nonComplianceMessages</code> column is optional. The documentation script does not generate this columns.</li>
</ul>
<p>EPAC will find the effect parameter name for each Policy in each Policy Set and use them. If no effect parameter is defined by the Policy Set, EPAC will use <code>overrides</code> to set the effect. EPAC will generate the <code>policyDefinitionReferenceId</code> for <code>nonComplianceMessages</code>.</p>
<p>After building the spreadsheet, you must reference the CSV file and the column prefix in each tree branch. <code>parameterFile</code> can be overridden in a child node; however, it is often used once per tree branch and defined adjacent to the <code>'definitionEntry</code> or <code>definitionEntryList</code>.</p>
<div class="highlight"><pre><span></span><code>&quot;parameterFile&quot;: &quot;security-baseline-parameters.csv&quot;,
&quot;definitionEntryList&quot;: [
    {
        &quot;policySetName&quot;: &quot;1f3afdf9-d0c9-4c3d-847f-89da613e70a8&quot;,
        &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
        &quot;assignment&quot;: {
            &quot;append&quot;: true,
            &quot;name&quot;: &quot;asb&quot;,
            &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
            &quot;description&quot;: &quot;Azure Security Benchmark Initiative. &quot;
        }
    },
    {
        &quot;policySetName&quot;: &quot;179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
        &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
        &quot;assignment&quot;: {
            &quot;append&quot;: true,
            &quot;name&quot;: &quot;nist-800-53-r5&quot;,
            &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
            &quot;description&quot;: &quot;NIST SP 800-53 Rev. 5 Initiative.&quot;
        }
    }
],
</code></pre></div>
<p>In the child nodes specifying the scope(s) specify which column prefix to use for selecting the CSV columns with <code>parameterSelector</code>. The actual prefix names have no meaning; they only need to match between the JSON below and the CSV file.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;nodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;assignment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pr-&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;displayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod Environment controls enforcement with initiative &quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;parameterSelector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;epac-dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;/providers/Microsoft.Management/managementGroups/Epac-Mg-Prod&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;tenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span>
</code></pre></div>
<p>The element <code>nonComplianceMessageColumn</code> may appear anywhere in the tree. Definitions at a child override the previous setting. If no <code>nonComplianceMessageColumn</code> is specified, the spreadsheet is not used for the (optional) <code>nonComplianceMessages</code>.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;nodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;assignment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pr-&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;displayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod Environment controls enforcement with initiative &quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;parameterSelector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;nonComplianceMessageColumn&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;nonComplianceMessages&quot;</span>
<span class="w">    </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;epac-dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;/providers/Microsoft.Management/managementGroups/Epac-Mg-Prod&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;tenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span>
</code></pre></div>
<h2 id="defining-resourceselectors">Defining <code>resourceSelectors</code></h2>
<p><code>resourceSelectors</code> may appear anywhere in the tree and are cumulative in any branch. <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/assignment-structure#resource-selectors-preview">They follow the standard Azure Format</a>.</p>
<div class="highlight"><pre><span></span><code>&quot;resourceSelectors&quot;: [
    {
        &quot;name&quot;: &quot;SDPRegions&quot;,
        &quot;selectors&quot;: [
            {
                &quot;kind&quot;: &quot;resourceLocation&quot;,
                &quot;in&quot;: [ &quot;eastus&quot;, &quot;westus&quot;, &quot;centralus&quot;, &quot;southcentralus&quot; ]
            }
        ]
    }
]
</code></pre></div>
<h2 id="defining-metadata">Defining <code>metadata</code></h2>
<p><code>metadata</code> is sometimes used to track tickets for changes. Do NOT specify EPAC-reserved elements <code>roles</code> and <code>pacOwnerId</code>. For the final <code>metadata</code> EPAC creates the union of instances in the entire tree branch.</p>
<div class="highlight"><pre><span></span><code>&quot;metadata&quot;: {
    &quot;someItem&quot;: &quot;Lorem Ipsum&quot;
}
</code></pre></div>
<h2 id="defining-enforcementmode">Defining <code>enforcementMode</code></h2>
<p><code>enforcementMode</code> is similar to the deprecated <code>ignoreBranch</code>; it deploys the assignment and sets the assignment to <code>Default</code> or <code>DoNotEnforce</code>. <code>DoNotEnforce</code> allows a what-if analysis. <code>enforcementMode</code> may appear anywhere in the tree. Definitions at a child override the previous setting.</p>
<div class="highlight"><pre><span></span><code>&quot;enforcementMode&quot;: &quot;DoNotEnforce&quot;,
</code></pre></div>
<h2 id="example-assignment-files">Example assignment files</h2>
<h3 id="simple-policy-assignment-allowed-locations">Simple Policy Assignment (Allowed Locations)</h3>
<p>In the simple case an assignment is a single assignment or with no difference in <code>assignment</code>, <code>parameters</code>, and <code>definitionEntry</code> across multiple scopes. In many scenarios "Allowed Locations" is such a simple Assignment. Such Assignments do not have child nodes, just the root node.</p>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/root&quot;,
  &quot;definitionEntry&quot;: {
    &quot;displayName&quot;: &quot;Allowed Locations Initiative&quot;,
    &quot;policySetName&quot;: &quot;general-allowed-locations-policy-set&quot;
  },
  &quot;assignment&quot;: {
    &quot;name&quot;: &quot;allowed-locations&quot;,
    &quot;displayName&quot;: &quot;Allowed Locations&quot;,
    &quot;description&quot;: &quot;Sets the allowed locations&quot;
  },
  &quot;metadata&quot;: {},
  &quot;enforcementMode&quot;: &quot;Default&quot;,
  &quot;parameters&quot;: {
    &quot;AllowedLocations&quot;: [
      &quot;centralus&quot;,
      &quot;eastus&quot;,
      &quot;eastus2&quot;,
      &quot;southcentralus&quot;
    ]
  },
  &quot;scope&quot;: {
    &quot;epac-dev&quot;: [
      &quot;/providers/Microsoft.Management/managementGroups/Epac-Mg-1&quot;
    ],
    &quot;tenant&quot;: [
      &quot;/providers/Microsoft.Management/managementGroups/c&quot;
    ]
  }
}
</code></pre></div>
<ul>
<li><code>nodeName</code> is required for error messages; it's value is immaterial. EPAC concatenates them in the current tree branch.</li>
<li><code>definitionEntry</code> specifies that the custom Policy Set <code>general-allowed-locations-policy-set</code> from our starter kit. <code>displayName</code> has no meaning - it is for readability and in this instance is superfluous.</li>
<li><code>assignment</code> fields <code>name</code>, <code>displayName</code> and <code>description</code> are used when creating the assignment.</li>
<li>This assignment has no <code>metadata</code>. You don't need an empty collection. EPAC will add <code>pacOwnerId</code> and <code>roles</code> <code>metadata</code>. Do not add them manually.</li>
<li>enforcementMode is set to default - it is superfluous.</li>
<li><code>parameters</code> are obvious. Note: you don't add the <code>value</code> layer Azure inserts - EPAC takes care of that.</li>
<li><code>scope</code>:</li>
<li>During Policy resource development (called <code>epac-dev</code>) the Assignment is deployed to an EPAC development Management Group <code>Epac-Mg-1</code>.</li>
<li>During Policy prod deployments (<code>tenant</code>-wide), it is deployed to the tenant Management Group <code>Epac-Mg-1</code>.</li>
<li>No <code>notScope</code> entries are specified.</li>
</ul>
<p>If we remove the empty and superfluous entries, we arrive at:</p>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/root&quot;,
  &quot;definitionEntry&quot;: {
    &quot;policySetName&quot;: &quot;general-allowed-locations-policy-set&quot;
  },
  &quot;assignment&quot;: {
    &quot;name&quot;: &quot;allowed-locations&quot;,
    &quot;displayName&quot;: &quot;Allowed Locations&quot;,
    &quot;description&quot;: &quot;Sets the allowed locations&quot;
  },
  &quot;parameters&quot;: {
    &quot;AllowedLocations&quot;: [
      &quot;centralus&quot;,
      &quot;eastus&quot;,
      &quot;eastus2&quot;,
      &quot;southcentralus&quot;
    ]
  },
  &quot;scope&quot;: {
    &quot;epac-dev&quot;: [
      &quot;/providers/Microsoft.Management/managementGroups/Epac-Mg-1&quot;
    ],
    &quot;tenant&quot;: [
      &quot;/providers/Microsoft.Management/managementGroups/c&quot;
    ]
  }
}
</code></pre></div>
<h3 id="security-focused-policy-assignment-with-json-parameters">Security-Focused Policy Assignment with JSON parameters</h3>
<ul>
<li>In the following example we named our root node (<code>nodeName</code>) <code>/security/</code>. Since it is only used in case of error messages produced by EPAC during planning it's actual value doesn't matter as long as it's unique.</li>
<li>We use a <code>definitionEntryList</code> to create two assignments at every leaf (six assignments total).</li>
<li>For <code>assignment</code> string concatenation we append the strings in the <code>definitionEntryList</code> to the strings in the child nodes. You can see this best when you look at the <code>description</code> string in the child  nodes. It will form a sentence when concatenated by <code>append</code>ing the <code>definitionEntryList</code> <code>assignment</code> field <code>description</code>.</li>
<li>The <code>parameters</code> specified in the children are specific to the IaC environment types and their <code>scope</code>. Note: a real assignment would define many more parameters. The set here is abbreviated since the actual set could easily exceed a hundred entries for each of the IaC environments. We'll see in the next example how to simplify large Policy Set parameters with a CSV file.</li>
</ul>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/Security/&quot;,
  &quot;definitionEntryList&quot;: [
    {
      &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/1f3afdf9-d0c9-4c3d-847f-89da613e70a8&quot;,
      &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
      &quot;assignment&quot;: {
        &quot;append&quot;: true,
        &quot;name&quot;: &quot;asb&quot;,
        &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
        &quot;description&quot;: &quot;Azure Security Benchmark Initiative.&quot;
      }
    },
    {
      &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
      &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
      &quot;assignment&quot;: {
        &quot;append&quot;: true,
        &quot;name&quot;: &quot;nist-800-53-r5&quot;,
        &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
        &quot;description&quot;: &quot;NIST SP 800-53 Rev. 5 Initiative.&quot;
      }
    }
  ],
  &quot;children&quot;: [
    {
      &quot;nodeName&quot;: &quot;Prod/&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;pr-&quot;,
        &quot;displayName&quot;: &quot;Prod &quot;,
        &quot;description&quot;: &quot;Prod Environment controls enforcement with &quot;
      },
      &quot;parameters&quot;: {
        &quot;classicComputeVMsMonitoringEffect&quot;: &quot;Deny&quot;,
        &quot;disallowPublicBlobAccessEffect&quot;: &quot;deny&quot;,
        &quot;azureCosmosDBAccountsShouldHaveFirewallRulesMonitoringEffect&quot;: &quot;Deny&quot;,
        &quot;allowedContainerImagesInKubernetesClusterEffect&quot;: &quot;Audit&quot;,
        &quot;AllowedHostNetworkingAndPortsInKubernetesClusterEffect&quot;: &quot;Disabled&quot;,
        &quot;clusterProtectionLevelInServiceFabricMonitoringEffect&quot;: &quot;Deny&quot;,
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-prod&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod&quot;
        ]
      }
    },
    {
      &quot;nodeName&quot;: &quot;NonProd/&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;np-&quot;,
        &quot;displayName&quot;: &quot;NonProd &quot;,
        &quot;description&quot;: &quot;Non Prod Environment controls enforcement with &quot;
      },
      &quot;parameters&quot;: {
        &quot;classicComputeVMsMonitoringEffect&quot;: &quot;Deny&quot;,
        &quot;disallowPublicBlobAccessEffect&quot;: &quot;deny&quot;,
        &quot;azureCosmosDBAccountsShouldHaveFirewallRulesMonitoringEffect&quot;: &quot;Audit&quot;,
        &quot;allowedContainerImagesInKubernetesClusterEffect&quot;: &quot;Audit&quot;,
        &quot;AllowedHostNetworkingAndPortsInKubernetesClusterEffect&quot;: &quot;Disabled&quot;,
        &quot;clusterProtectionLevelInServiceFabricMonitoringEffect&quot;: &quot;Audit&quot;,
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-nonprod&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-nonprod&quot;
        ]
      }
    },
    {
      &quot;nodeName&quot;: &quot;Sandbox/&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;sbx-&quot;,
        &quot;displayName&quot;: &quot;Sandbox &quot;,
        &quot;description&quot;: &quot;Sandbox Environment controls enforcement with &quot;
      },
      &quot;parameters&quot;: {
        &quot;classicStorageAccountsMonitoringEffect&quot;: &quot;Deny&quot;,
        &quot;allowedServicePortsInKubernetesClusterEffect&quot;: &quot;Disabled&quot;,
        &quot;certificatesValidityPeriodInMonths&quot;: 13,
        &quot;AllowedAppArmorProfilesInKubernetesClusterEffect&quot;: &quot;Disabled&quot;,
        &quot;certificatesValidityPeriodMonitoringEffect&quot;: &quot;disabled&quot;,
        &quot;cognitiveServicesAccountsShouldRestrictNetworkAccessMonitoringEffect&quot;: &quot;Disabled&quot;,
        &quot;AllowedCapabilitiesInKubernetesClusterEffect&quot;: &quot;Disabled&quot;
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-sandbox&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-Sandbox&quot;
        ]
      }
    }
  ]
}
</code></pre></div>
<h3 id="security-focused-policy-assignment-with-csv-file-parameters">Security-Focused Policy Assignment with CSV file parameters</h3>
<p>This example is the same as the previous, except we replaced inline JSON parameters with a CSV file and use the column prefixes in the CSV file to select which parameter values we use by:</p>
<ul>
<li>Setting the file name at the root node with</li>
</ul>
<p><code>jsonc
  "parameterFile": "security-baseline-parameters.csv",</code></p>
<ul>
<li>Setting the column prefix with <code>parameterSelector</code> to <code>prod</code>, <code>nonprod</code> and <code>sandbox</code>. For example:</li>
</ul>
<div class="highlight"><pre><span></span><code>&quot;parameterSelector&quot;: &quot;prod&quot;,
</code></pre></div>
<p>The CSV file is explained <a href="#define-assignment-parameters-with-a-csv-file">above</a>. The entire file is:</p>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/Security/&quot;,
  &quot;parameterFile&quot;: &quot;security-baseline-parameters.csv&quot;,
  &quot;definitionEntryList&quot;: [
    {
      &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/1f3afdf9-d0c9-4c3d-847f-89da613e70a8&quot;,
      &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
      &quot;assignment&quot;: {
        &quot;append&quot;: true,
        &quot;name&quot;: &quot;asb&quot;,
        &quot;displayName&quot;: &quot;Azure Security Benchmark&quot;,
        &quot;description&quot;: &quot;Azure Security Benchmark Initiative.&quot;
      }
    },
    {
      &quot;policySetId&quot;: &quot;/providers/Microsoft.Authorization/policySetDefinitions/179d1daa-458f-4e47-8086-2a68d0d6c38f&quot;,
      &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
      &quot;assignment&quot;: {
        &quot;append&quot;: true,
        &quot;name&quot;: &quot;nist-800-53-r5&quot;,
        &quot;displayName&quot;: &quot;NIST SP 800-53 Rev. 5&quot;,
        &quot;description&quot;: &quot;NIST SP 800-53 Rev. 5 Initiative.&quot;
      }
    }
  ],
  &quot;children&quot;: [
    {
      &quot;nodeName&quot;: &quot;Prod/&quot;,
      &quot;parameterSelector&quot;: &quot;prod&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;pr-&quot;,
        &quot;displayName&quot;: &quot;Prod &quot;,
        &quot;description&quot;: &quot;Prod Environment controls enforcement with &quot;
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-prod&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-Prod&quot;
        ]
      }
    },
    {
      &quot;nodeName&quot;: &quot;NonProd/&quot;,
      &quot;parameterSelector&quot;: &quot;nonprod&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;np-&quot;,
        &quot;displayName&quot;: &quot;NonProd &quot;,
        &quot;description&quot;: &quot;Non Prod Environment controls enforcement with &quot;
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-nonprod&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-nonprod&quot;
        ]
      }
    },
    {
      &quot;nodeName&quot;: &quot;Sandbox/&quot;,
      &quot;parameterSelector&quot;: &quot;sandbox&quot;,
      &quot;assignment&quot;: {
        &quot;name&quot;: &quot;sbx-&quot;,
        &quot;displayName&quot;: &quot;Sandbox &quot;,
        &quot;description&quot;: &quot;Sandbox Environment controls enforcement with &quot;
      },
      &quot;scope&quot;: {
        &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-sandbox&quot;
        ],
        &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-Sandbox&quot;
        ]
      }
    }
  ]
}
</code></pre></div>
<h3 id="inverted-policy-assignment-tag-inheritance-and-required-tags">Inverted Policy Assignment (Tag Inheritance and Required Tags)</h3>
<p>As mentioned above sometimes it is advantageous (to reduce the number of repetitions) to turn a definition on its head:</p>
<ul>
<li><strong>Common</strong> <code>parameters</code>, <code>scope</code>, <code>definitionEntryList</code> (with two Policies) at the root (<code>nodeName</code> is <code>/Tags/</code>).</li>
<li>Start of the <code>assignment</code> strings (<code>append</code> is defaulted to <code>false</code>). Again look at description which will be a concatenated sentence.</li>
<li>The children define the <code>tagName</code> parameter and the second part of the strings for <code>assignment</code>. The set of <code>parameters</code> is the union of the root node and the child node.</li>
<li>This creates six Assignments (number of Policies assigned times number of children).</li>
</ul>
<div class="highlight"><pre><span></span><code>{
  &quot;nodeName&quot;: &quot;/Tags/&quot;,
  &quot;parameters&quot;: {
    &quot;excludedRG&quot;: [
      &quot;synapseworkspace-managedrg-*&quot;,
      &quot;databricks-rg-*&quot;,
      &quot;managed*&quot;
    ]
  },
  &quot;scope&quot;: {
      &quot;epac-dev&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/epac-dev-mg-1&quot;
      ],
      &quot;tenant&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/Contoso-Root&quot;
      ]
  },
  &quot;definitionEntryList&quot;: [
      {
          &quot;policyName&quot;: &quot;rg-required-tag-dynamic-notscope&quot;,
          &quot;assignment&quot;: {
              &quot;name&quot;: &quot;rgtag-&quot;,
              &quot;displayName&quot;: &quot;Require Tag on Resource Group - &quot;,
              &quot;description&quot;: &quot;Require Tag for Resource Groups when any resource group (not listed in in excludedRg) is created or updated - &quot;
          }
      },
      {
          &quot;policyName&quot;: &quot;resources-inherit-rg-tag-dynamic-notscope&quot;,
          &quot;assignment&quot;: {
              &quot;name&quot;: &quot;taginh-&quot;,
              &quot;displayName&quot;: &quot;Inherit Tag from Resource Group - &quot;,
              &quot;description&quot;: &quot;Modify Tag to comply with governance goal of enforcing Tags by inheriting Tags from RG - &quot;
          }
      }
  ],
  &quot;children&quot;: [
      {
          &quot;nodeName&quot;: &quot;AppName&quot;,
          &quot;assignment&quot;: {
              &quot;name&quot;: &quot;AppName&quot;,
              &quot;displayName&quot;: &quot;AppName&quot;,
              &quot;description&quot;: &quot;AppName.&quot;
          },
          &quot;parameters&quot;: {
              &quot;tagName&quot;: &quot;AppName&quot;
          }
      },
      {
          &quot;nodeName&quot;: &quot;Environment&quot;,
          &quot;assignment&quot;: {
              &quot;name&quot;: &quot;Environment&quot;,
              &quot;displayName&quot;: &quot;Environment&quot;,
              &quot;description&quot;: &quot;Environment.&quot;
          },
          &quot;parameters&quot;: {
              &quot;tagName&quot;: &quot;Environment&quot;
          }
      },
      {
          &quot;nodeName&quot;: &quot;Project&quot;,
          &quot;assignment&quot;: {
              &quot;name&quot;: &quot;Project&quot;,
              &quot;displayName&quot;: &quot;Project&quot;,
              &quot;description&quot;: &quot;Project.&quot;
          },
          &quot;parameters&quot;: {
              &quot;tagName&quot;: &quot;Project&quot;
          }
      }
  ]
}
</code></pre></div>
<h3 id="non-compliance-messages-in-a-policy-definition-assignment">Non-Compliance Messages in a Policy Definition Assignment</h3>
<p>An example of a policy assignment for a single policy definition with a default non-compliance message.</p>
<div class="highlight"><pre><span></span><code>{
    &quot;nodeName&quot;: &quot;test&quot;,
    &quot;scope&quot;: {
        &quot;issue48&quot;: [
            &quot;/providers/Microsoft.Management/managementGroups/issue48&quot;
        ]
    },
    &quot;assignment&quot;: {
        &quot;displayName&quot;: &quot;Audit virtual machines without disaster recovery configured&quot;,
        &quot;description&quot;: null,
        &quot;name&quot;: &quot;46332f3a51cb4bf2b4de78a7&quot;
    },
    &quot;definitionEntry&quot;: {
        &quot;policyName&quot;: &quot;0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56&quot; // Single policy definition
    },
    &quot;nonComplianceMessages&quot;: [ // Array of nonComplianceMessages
        {
            &quot;Message&quot;: &quot;Update non-compliance message&quot; // Default nonComplianceMessage
        }
    ],
    &quot;parameters&quot;: {}
}
</code></pre></div>
<h3 id="non-compliance-messages-in-a-policy-set-definition-assignment">Non-Compliance Messages in a Policy Set Definition Assignment</h3>
<p>An example of a policy assignment for a policy set definition with a default non-compliance message and a policy specific non-compliance message.</p>
<div class="highlight"><pre><span></span><code>{
    &quot;nodeName&quot;: &quot;test&quot;,
    &quot;scope&quot;: {
        &quot;issue48&quot;: [
            &quot;/providers/Microsoft.Management/managementGroups/issue48&quot;
        ]
    },
    &quot;assignment&quot;: {
        &quot;displayName&quot;: &quot;Configure Azure Defender for SQL agents on virtual machines&quot;,
        &quot;description&quot;: null,
        &quot;name&quot;: &quot;39a366e6&quot;
    },
    &quot;definitionEntry&quot;: {
        &quot;initiativeName&quot;: &quot;39a366e6-fdde-4f41-bbf8-3757f46d1611&quot; // Policy set definition
    },
    &quot;nonComplianceMessages&quot;: [ // Array of nonComplianceMessages
        {
            &quot;message&quot;: &quot;Update main message&quot; // Default nonComplianceMessage
        },
        {
            &quot;message&quot;: &quot;Individual policy message&quot;, // Policy specific nonComplianceMessage. You must include the policyDefinitionReferenceId as defined in the initiative.
            &quot;policyDefinitionReferenceId&quot;: &quot;ASC_DeployAzureDefenderForSqlAdvancedThreatProtectionWindowsAgent&quot;
        }
    ],
    &quot;parameters&quot;: {}
}
</code></pre></div>
<h3 id="non-compliance-messages-in-a-policy-set-definition-assignment-with-a-definitionentrylist">Non-Compliance Messages in a Policy Set Definition Assignment with a <code>definitionEntryList</code></h3>
<p>An example of how to use a non-compliance message when using a <code>definitionEntryList</code> list in the assignment.</p>
<div class="highlight"><pre><span></span><code>{
    &quot;nodeName&quot;: &quot;test&quot;,
    &quot;scope&quot;: {
        &quot;issue48&quot;: [
            &quot;/providers/Microsoft.Management/managementGroups/issue48&quot;
        ]
    },
    &quot;definitionEntryList&quot;: [
        {
            &quot;initiativeName&quot;: &quot;62329546-775b-4a3d-a4cb-eb4bb990d2c0&quot;,
            &quot;assignment&quot;: {
                &quot;displayName&quot;: &quot;Flow logs should be configured and enabled for every network security group&quot;,
                &quot;description&quot;: &quot;Audit for network security groups to verify if flow logs are configured and if flow log status is enabled. Enabling flow logs allows to log information about IP traffic flowing through network security group. It can be used for optimizing network flows, monitoring throughput, verifying compliance, detecting intrusions and more.&quot;,
                &quot;name&quot;: &quot;62329546&quot;
            },
            &quot;nonComplianceMessages&quot;: [ // nonComplianceMessages must be in the definitionEntryList object for each policy/initiative deployed.
                {
                    &quot;message&quot;: &quot;Updated Default message&quot;
                },
                {
                    &quot;message&quot;: &quot;Individual policy message&quot;,
                    &quot;policyDefinitionReferenceId&quot;: &quot;NetworkWatcherFlowLog_Enabled_Audit&quot;
                }
            ]
        },
        {
            &quot;initiativeName&quot;: &quot;cb5e1e90-7c33-491c-a15b-24885c915752&quot;,
            &quot;assignment&quot;: {
                &quot;displayName&quot;: &quot;Enable Azure Cosmos DB throughput policy&quot;,
                &quot;description&quot;: &quot;Enable throughput control for Azure Cosmos DB resources in the specified scope (Management group, Subscription or resource group). Takes max throughput as parameter. Use this policy to help enforce throughput control via the resource provider.&quot;,
                &quot;name&quot;: &quot;cb5e1e90&quot;
            }
        }
    ],
    &quot;parameters&quot;: {
        &quot;throughputMax&quot;: 400
    }
}
</code></pre></div>
<h2 id="reading-list">Reading List</h2>
<ul>
<li><a href="../operating-environment/">Setup DevOps Environment</a> .</li>
<li><a href="../clone-github/">Create a source repository and import the source code</a> from this repository.</li>
<li><a href="../desired-state-strategy/">Select the desired state strategy</a></li>
<li><a href="../definitions-and-global-settings/">Define your deployment environment</a> in <code>global-settings.jsonc</code>.</li>
<li><a href="../ci-cd-pipeline/">Build your CI/CD pipeline</a> using a starter kit.</li>
<li>Optional: generate a starting point for the <code>Definitions</code> folders:</li>
<li><a href="../extract-existing-policy-resources/">Extract existing Policy resources from an environment</a>.</li>
<li><a href="../cloud-adoption-framework/">Import Policies from the Cloud Adoption Framework</a>.</li>
<li><a href="../policy-definitions/">Add custom Policies</a>.</li>
<li><a href="../policy-set-definitions/">Add custom Policy Sets</a>.</li>
<li><a href="./">Create Policy Assignments</a>.</li>
<li>Import Policies from the <a href="../cloud-adoption-framework/">Cloud Adoption Framework</a>.</li>
<li><a href="../policy-exemptions/">Manage Policy Exemptions</a>.</li>
<li><a href="../documenting-assignments-and-policy-sets/">Document your deployments</a>.</li>
<li><a href="../operational-scripts/">Execute operational tasks</a>.</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.indexes", {"navigation.sections": {"level": 1}}, "navigation.tabs", "navigation.tabs.sticky", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>